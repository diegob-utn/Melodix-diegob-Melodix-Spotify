@model SuscripcionPlanesViewModel
@{
    ViewData["Title"] = "Planes de suscripción";
}

<div class="container">
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold">Elige tu plan Melodix</h1>
        <p class="lead text-muted">Disfruta de música sin límites con nuestros planes premium</p>
    </div>

    <div class="row justify-content-center">
        @foreach (var plan in Model.Planes)
        {
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card h-100 border-secondary bg-dark">
                    <div class="card-body text-center">
                        <h3 class="card-title">@plan.Nombre</h3>
                        <div class="display-4 fw-bold text-primary mb-3">
                            $@plan.Precio.ToString("F2")
                            <small class="fs-6 text-muted">/@(plan.DuracionMeses == 1 ? "mes" : plan.DuracionMeses + " meses")</small>
                        </div>
                        
                        <p class="text-muted mb-4">@plan.Descripcion</p>
                        
                        <ul class="list-unstyled mb-4">
                            @if (plan.Precio == 0)
                            {
                                <li class="mb-2">
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    Reproducción con anuncios
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    Saltos limitados
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    Calidad estándar
                                </li>
                            }
                            else
                            {
                                <li class="mb-2">
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    Reproducción sin anuncios
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    Saltos ilimitados
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    Descarga offline
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    Calidad alta (@plan.MaxCuentas cuentas)
                                </li>
                            }
                        </ul>
                        
                        @if (Model.PlanActual?.Id == plan.Id)
                        {
                            <button class="btn btn-success w-100" disabled>
                                <i class="bi bi-check-circle me-2"></i>
                                Plan actual
                            </button>
                        }
                        else if (plan.Precio == 0)
                        {
                            <button class="btn btn-outline-primary w-100" disabled>
                                Plan gratuito
                            </button>
                        }
                        else
                        {
                            <a href="@Url.Action("Comprar", new { planId = plan.Id })" 
                               class="btn btn-primary w-100">
                                Elegir @plan.Nombre
                            </a>
                        }
                    </div>
                </div>
            </div>
        }
    </div>

    @if (Model.PlanActual != null && Model.PlanActual.Precio > 0)
    {
        <div class="row justify-content-center mt-5">
            <div class="col-md-8">
                <div class="card bg-dark border-secondary">
                    <div class="card-body text-center">
                        <h5 class="card-title">Tu suscripción actual</h5>
                        <p class="text-muted">
                            Tienes el plan <strong>@Model.PlanActual.Nombre</strong>
                        </p>
                        <div class="d-flex justify-content-center gap-3">
                            <a href="@Url.Action("MiPlan")" class="btn btn-outline-primary">
                                <i class="bi bi-gear me-2"></i>
                                Gestionar suscripción
                            </a>
                            <button class="btn btn-outline-danger" onclick="cancelarSuscripcion()">
                                <i class="bi bi-x-circle me-2"></i>
                                Cancelar suscripción
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- FAQ Section -->
    <div class="row justify-content-center mt-5">
        <div class="col-md-10">
            <h3 class="text-center mb-4">Preguntas frecuentes</h3>
            <div class="accordion" id="faqAccordion">
                <div class="accordion-item bg-dark border-secondary">
                    <h2 class="accordion-header">
                        <button class="accordion-button bg-dark text-light border-0" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                            ¿Puedo cambiar de plan en cualquier momento?
                        </button>
                    </h2>
                    <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            Sí, puedes cambiar tu plan en cualquier momento. Los cambios se aplicarán inmediatamente y se ajustará el costo proporcionalmente.
                        </div>
                    </div>
                </div>
                
                <div class="accordion-item bg-dark border-secondary">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed bg-dark text-light border-0" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                            ¿Hay permanencia mínima?
                        </button>
                    </h2>
                    <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            No, no hay permanencia mínima. Puedes cancelar tu suscripción en cualquier momento y seguir disfrutando del servicio hasta el final del período pagado.
                        </div>
                    </div>
                </div>
                
                <div class="accordion-item bg-dark border-secondary">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed bg-dark text-light border-0" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                            ¿Qué métodos de pago aceptan?
                        </button>
                    </h2>
                    <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            Aceptamos tarjetas de crédito y débito (Visa, MasterCard, American Express), PayPal y transferencia bancaria.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function cancelarSuscripcion() {
    if (confirm('¿Estás seguro de que quieres cancelar tu suscripción? Podrás seguir usando el servicio premium hasta el final del período pagado.')) {
        window.location.href = '@Url.Action("Cancelar")';
    }
}
</script>
